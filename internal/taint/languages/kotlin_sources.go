package languages

import (
	"github.com/turen/gtss/internal/rules"
	"github.com/turen/gtss/internal/taint"
)

func (c *KotlinCatalog) Sources() []taint.SourceDef {
	return []taint.SourceDef{
		// --- Ktor framework ---
		{
			ID:          "kotlin.ktor.queryparameters",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `call\.request\.queryParameters`,
			ObjectType:  "ApplicationCall",
			MethodName:  "request.queryParameters",
			Description: "Ktor query parameters",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.ktor.receive",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `call\.receive\s*[<(]`,
			ObjectType:  "ApplicationCall",
			MethodName:  "receive",
			Description: "Ktor request body deserialization",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.ktor.headers",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `call\.request\.headers`,
			ObjectType:  "ApplicationCall",
			MethodName:  "request.headers",
			Description: "Ktor request headers",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.ktor.parameters",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `call\.parameters`,
			ObjectType:  "ApplicationCall",
			MethodName:  "parameters",
			Description: "Ktor route parameters",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.ktor.receivemultipart",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `call\.receiveMultipart\s*\(`,
			ObjectType:  "ApplicationCall",
			MethodName:  "receiveMultipart",
			Description: "Ktor multipart form data",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.ktor.receivetext",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `call\.receiveText\s*\(`,
			ObjectType:  "ApplicationCall",
			MethodName:  "receiveText",
			Description: "Ktor raw request body text",
			Assigns:     "return",
		},

		// --- Spring Kotlin ---
		{
			ID:          "kotlin.spring.requestparam",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `@RequestParam`,
			ObjectType:  "Spring",
			MethodName:  "@RequestParam",
			Description: "Spring request parameter binding",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.spring.requestbody",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `@RequestBody`,
			ObjectType:  "Spring",
			MethodName:  "@RequestBody",
			Description: "Spring request body deserialization",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.spring.pathvariable",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `@PathVariable`,
			ObjectType:  "Spring",
			MethodName:  "@PathVariable",
			Description: "Spring URL path variable",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.spring.requestheader",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `@RequestHeader`,
			ObjectType:  "Spring",
			MethodName:  "@RequestHeader",
			Description: "Spring request header binding",
			Assigns:     "return",
		},

		// --- Android ---
		{
			ID:          "kotlin.android.intent.getstringextra",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `intent\.getStringExtra\s*\(`,
			ObjectType:  "Intent",
			MethodName:  "getStringExtra",
			Description: "Android Intent string extra",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.android.intent.extras",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `intent\.extras`,
			ObjectType:  "Intent",
			MethodName:  "extras",
			Description: "Android Intent extras bundle",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.android.bundle.getstring",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `bundle\.getString\s*\(|arguments\?.getString\s*\(`,
			ObjectType:  "Bundle",
			MethodName:  "getString",
			Description: "Android Bundle string value",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.android.edittext.gettext",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `\.text\.toString\s*\(\)|\.getText\s*\(\)`,
			ObjectType:  "EditText",
			MethodName:  "getText",
			Description: "Android EditText user input",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.android.contentresolver.query",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `contentResolver\.query\s*\(`,
			ObjectType:  "ContentResolver",
			MethodName:  "query",
			Description: "Android ContentResolver query result",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.android.intent.data",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `intent\.data`,
			ObjectType:  "Intent",
			MethodName:  "data",
			Description: "Android Intent data URI",
			Assigns:     "return",
		},

		// --- Standard library ---
		{
			ID:          "kotlin.readLine",
			Category:    taint.SrcUserInput,
			Language:    rules.LangKotlin,
			Pattern:     `readLine\s*\(`,
			ObjectType:  "",
			MethodName:  "readLine",
			Description: "Kotlin standard input",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.system.getenv",
			Category:    taint.SrcEnvVar,
			Language:    rules.LangKotlin,
			Pattern:     `System\.getenv\s*\(`,
			ObjectType:  "System",
			MethodName:  "getenv",
			Description: "Environment variable",
			Assigns:     "return",
		},
		{
			ID:          "kotlin.args",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangKotlin,
			Pattern:     `fun\s+main\s*\(\s*args`,
			ObjectType:  "",
			MethodName:  "main args",
			Description: "Command-line arguments",
			Assigns:     "return",
		},

		// --- Network / IO ---
		{
			ID:          "kotlin.bufferedreader.readline",
			Category:    taint.SrcNetwork,
			Language:    rules.LangKotlin,
			Pattern:     `\.readLine\s*\(|\.readText\s*\(`,
			ObjectType:  "BufferedReader",
			MethodName:  "readLine/readText",
			Description: "BufferedReader input (network/file)",
			Assigns:     "return",
		},

		// --- Deserialization ---
		{
			ID:          "kotlin.jackson.readvalue",
			Category:    taint.SrcDeserialized,
			Language:    rules.LangKotlin,
			Pattern:     `objectMapper\.readValue\s*[<(]|mapper\.readValue\s*[<(]`,
			ObjectType:  "ObjectMapper",
			MethodName:  "readValue",
			Description: "Jackson deserialized JSON data",
			Assigns:     "return",
		},
	}
}
