package languages

import (
	"github.com/turenio/gtss/internal/rules"
	"github.com/turenio/gtss/internal/taint"
)

func (c *PythonCatalog) Sources() []taint.SourceDef {
	return []taint.SourceDef{
		// --- Flask ---
		{
			ID:          "py.flask.request.args",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.args`,
			ObjectType:  "flask.Request",
			MethodName:  "args",
			Description: "Flask query parameters",
			Assigns:     "return",
		},
		{
			ID:          "py.flask.request.form",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.form`,
			ObjectType:  "flask.Request",
			MethodName:  "form",
			Description: "Flask form data",
			Assigns:     "return",
		},
		{
			ID:          "py.flask.request.data",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.data`,
			ObjectType:  "flask.Request",
			MethodName:  "data",
			Description: "Flask raw request data",
			Assigns:     "return",
		},
		{
			ID:          "py.flask.request.json",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.json\b|request\.get_json\(`,
			ObjectType:  "flask.Request",
			MethodName:  "json/get_json",
			Description: "Flask JSON request body",
			Assigns:     "return",
		},
		{
			ID:          "py.flask.request.values",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.values`,
			ObjectType:  "flask.Request",
			MethodName:  "values",
			Description: "Flask combined query and form parameters",
			Assigns:     "return",
		},
		{
			ID:          "py.flask.request.headers",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.headers`,
			ObjectType:  "flask.Request",
			MethodName:  "headers",
			Description: "Flask request headers",
			Assigns:     "return",
		},
		{
			ID:          "py.flask.request.cookies",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.cookies`,
			ObjectType:  "flask.Request",
			MethodName:  "cookies",
			Description: "Flask request cookies",
			Assigns:     "return",
		},
		{
			ID:          "py.flask.request.files",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.files`,
			ObjectType:  "flask.Request",
			MethodName:  "files",
			Description: "Flask file uploads",
			Assigns:     "return",
		},

		// --- Django ---
		{
			ID:          "py.django.request.get",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.GET`,
			ObjectType:  "django.http.HttpRequest",
			MethodName:  "GET",
			Description: "Django GET query parameters",
			Assigns:     "return",
		},
		{
			ID:          "py.django.request.post",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.POST`,
			ObjectType:  "django.http.HttpRequest",
			MethodName:  "POST",
			Description: "Django POST form data",
			Assigns:     "return",
		},
		{
			ID:          "py.django.request.body",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.body`,
			ObjectType:  "django.http.HttpRequest",
			MethodName:  "body",
			Description: "Django raw request body",
			Assigns:     "return",
		},

		// --- FastAPI ---
		{
			ID:          "py.fastapi.param",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `Query\(|Path\(|Body\(|Form\(|Header\(|Cookie\(`,
			ObjectType:  "fastapi",
			MethodName:  "Query/Path/Body/Form/Header/Cookie",
			Description: "FastAPI parameter dependency injection",
			Assigns:     "return",
		},

		// --- Standard library ---
		{
			ID:          "py.input",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `input\(`,
			ObjectType:  "",
			MethodName:  "input",
			Description: "Console input from user",
			Assigns:     "return",
		},
		{
			ID:          "py.sys.argv",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangPython,
			Pattern:     `sys\.argv`,
			ObjectType:  "",
			MethodName:  "sys.argv",
			Description: "Command-line arguments",
			Assigns:     "return",
		},
		{
			ID:          "py.os.environ",
			Category:    taint.SrcEnvVar,
			Language:    rules.LangPython,
			Pattern:     `os\.environ\[?|os\.getenv\(`,
			ObjectType:  "",
			MethodName:  "os.environ/getenv",
			Description: "Environment variables",
			Assigns:     "return",
		},
		{
			ID:          "py.socket.recv",
			Category:    taint.SrcNetwork,
			Language:    rules.LangPython,
			Pattern:     `\.recv\(`,
			ObjectType:  "socket.socket",
			MethodName:  "recv",
			Description: "Socket receive data",
			Assigns:     "return",
		},
		{
			ID:          "py.open.read",
			Category:    taint.SrcFileRead,
			Language:    rules.LangPython,
			Pattern:     `open\(.*\)\.read\(`,
			ObjectType:  "",
			MethodName:  "open().read",
			Description: "File read contents",
			Assigns:     "return",
		},
		{
			ID:          "py.urlopen",
			Category:    taint.SrcNetwork,
			Language:    rules.LangPython,
			Pattern:     `urllib\.request\.urlopen\(`,
			ObjectType:  "",
			MethodName:  "urlopen",
			Description: "URL open and read",
			Assigns:     "return",
		},

		// --- aiohttp ---
		{
			ID:          "py.aiohttp.request.query",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.query`,
			ObjectType:  "aiohttp.web.Request",
			MethodName:  "query",
			Description: "aiohttp query string parameters",
			Assigns:     "return",
		},
		{
			ID:          "py.aiohttp.request.post",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `await\s+request\.post\(`,
			ObjectType:  "aiohttp.web.Request",
			MethodName:  "post",
			Description: "aiohttp POST form data",
			Assigns:     "return",
		},
		{
			ID:          "py.aiohttp.request.json",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `await\s+request\.json\(`,
			ObjectType:  "aiohttp.web.Request",
			MethodName:  "json",
			Description: "aiohttp JSON request body",
			Assigns:     "return",
		},

		// --- Tornado ---
		{
			ID:          "py.tornado.get_argument",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `self\.get_argument\(|self\.get_arguments\(`,
			ObjectType:  "tornado.web.RequestHandler",
			MethodName:  "get_argument",
			Description: "Tornado query/body argument",
			Assigns:     "return",
		},
		{
			ID:          "py.tornado.get_body_argument",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `self\.get_body_argument\(`,
			ObjectType:  "tornado.web.RequestHandler",
			MethodName:  "get_body_argument",
			Description: "Tornado POST body argument",
			Assigns:     "return",
		},

		// --- Starlette ---
		{
			ID:          "py.starlette.request.query_params",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.query_params`,
			ObjectType:  "starlette.requests.Request",
			MethodName:  "query_params",
			Description: "Starlette query parameters",
			Assigns:     "return",
		},
		{
			ID:          "py.starlette.request.form",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `await\s+request\.form\(`,
			ObjectType:  "starlette.requests.Request",
			MethodName:  "form",
			Description: "Starlette form data",
			Assigns:     "return",
		},
		{
			ID:          "py.starlette.request.json",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `await\s+request\.json\(`,
			ObjectType:  "starlette.requests.Request",
			MethodName:  "json",
			Description: "Starlette JSON request body",
			Assigns:     "return",
		},

		// --- Celery ---
		{
			ID:          "py.celery.task_args",
			Category:    taint.SrcExternal,
			Language:    rules.LangPython,
			Pattern:     `@(app|celery)\.task|@shared_task`,
			ObjectType:  "celery",
			MethodName:  "task arguments",
			Description: "Celery task arguments from untrusted message broker",
			Assigns:     "return",
		},

		// --- Boto3/AWS SDK ---
		{
			ID:          "py.boto3.s3.get_object",
			Category:    taint.SrcExternal,
			Language:    rules.LangPython,
			Pattern:     `\.get_object\(`,
			ObjectType:  "boto3.S3.Client",
			MethodName:  "get_object",
			Description: "S3 object data from potentially untrusted bucket content",
			Assigns:     "return",
		},
		{
			ID:          "py.lambda.event",
			Category:    taint.SrcExternal,
			Language:    rules.LangPython,
			Pattern:     `def\s+\w+\(\s*event\s*,\s*context\s*\)`,
			ObjectType:  "aws.lambda",
			MethodName:  "lambda handler event",
			Description: "AWS Lambda event data from external trigger",
			Assigns:     "return",
		},

		// --- AWS SQS ---
		{
			ID:          "py.boto3.sqs.receive",
			Category:    taint.SrcExternal,
			Language:    rules.LangPython,
			Pattern:     `\.receive_message\(`,
			ObjectType:  "boto3.SQS.Client",
			MethodName:  "receive_message",
			Description: "AWS SQS message data from queue",
			Assigns:     "return",
		},
		// --- GCP Cloud Functions ---
		{
			ID:          "py.gcp.cloudfunctions.event",
			Category:    taint.SrcExternal,
			Language:    rules.LangPython,
			Pattern:     `def\s+\w+\(\s*(?:event|cloud_event)\s*(?:,\s*context)?\s*\)`,
			ObjectType:  "google.cloud.functions",
			MethodName:  "Cloud Function handler",
			Description: "GCP Cloud Functions event data from external trigger",
			Assigns:     "return",
		},
		// --- GCP Pub/Sub ---
		{
			ID:          "py.gcp.pubsub.pull",
			Category:    taint.SrcExternal,
			Language:    rules.LangPython,
			Pattern:     `\.pull\(|subscriber\.pull\(`,
			ObjectType:  "google.cloud.pubsub_v1.SubscriberClient",
			MethodName:  "pull",
			Description: "GCP Pub/Sub message data",
			Assigns:     "return",
		},
		// --- Azure Functions ---
		{
			ID:          "py.azure.functions.event",
			Category:    taint.SrcExternal,
			Language:    rules.LangPython,
			Pattern:     `def\s+\w+\(\s*req\s*:\s*func\.HttpRequest`,
			ObjectType:  "azure.functions",
			MethodName:  "Azure Function trigger",
			Description: "Azure Functions HTTP trigger request data",
			Assigns:     "return",
		},

		// --- Flask request path ---
		{
			ID:          "py.flask.request.url",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.url\b|request\.path\b|request\.full_path`,
			ObjectType:  "flask.Request",
			MethodName:  "url/path/full_path",
			Description: "Flask request URL/path (user-controlled)",
			Assigns:     "return",
		},

		// --- Flask request stream ---
		{
			ID:          "py.flask.request.stream",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.stream`,
			ObjectType:  "flask.Request",
			MethodName:  "stream",
			Description: "Flask request stream for raw data reading",
			Assigns:     "return",
		},

		// --- argparse ---
		{
			ID:          "py.argparse.parse_args",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangPython,
			Pattern:     `\.parse_args\(|argparse\.ArgumentParser`,
			ObjectType:  "argparse",
			MethodName:  "parse_args",
			Description: "Parsed command-line arguments via argparse",
			Assigns:     "return",
		},

		// --- Django request path ---
		{
			ID:          "py.django.request.path",
			Category:    taint.SrcUserInput,
			Language:    rules.LangPython,
			Pattern:     `request\.path\b|request\.get_full_path\(|request\.META`,
			ObjectType:  "django.http.HttpRequest",
			MethodName:  "path/get_full_path/META",
			Description: "Django request path and META headers",
			Assigns:     "return",
		},

		// --- pathlib file read ---
		{
			ID:          "py.pathlib.read_text",
			Category:    taint.SrcFileRead,
			Language:    rules.LangPython,
			Pattern:     `Path\(.*\)\.read_text\(|Path\(.*\)\.read_bytes\(`,
			ObjectType:  "pathlib.Path",
			MethodName:  "read_text/read_bytes",
			Description: "File contents via pathlib Path",
			Assigns:     "return",
		},
	}
}
