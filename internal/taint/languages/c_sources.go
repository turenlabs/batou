package languages

import (
	"github.com/turenio/gtss/internal/rules"
	"github.com/turenio/gtss/internal/taint"
)

func (c *CCatalog) Sources() []taint.SourceDef {
	return []taint.SourceDef{
		// --- Standard input ---
		{
			ID:          "c.stdin.scanf",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bscanf\s*\(`,
			ObjectType:  "",
			MethodName:  "scanf",
			Description: "Formatted input from stdin",
			Assigns:     "arg:1",
		},
		{
			ID:          "c.stdin.fscanf",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bfscanf\s*\(`,
			ObjectType:  "",
			MethodName:  "fscanf",
			Description: "Formatted input from file stream",
			Assigns:     "arg:2",
		},
		{
			ID:          "c.stdin.sscanf",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bsscanf\s*\(`,
			ObjectType:  "",
			MethodName:  "sscanf",
			Description: "Formatted input from string",
			Assigns:     "arg:2",
		},
		{
			ID:          "c.stdin.gets",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bgets\s*\(`,
			ObjectType:  "",
			MethodName:  "gets",
			Description: "Unbounded line input from stdin (always dangerous)",
			Assigns:     "arg:0",
		},
		{
			ID:          "c.stdin.fgets",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bfgets\s*\(`,
			ObjectType:  "",
			MethodName:  "fgets",
			Description: "Line input from file stream",
			Assigns:     "arg:0",
		},
		{
			ID:          "c.stdin.getchar",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bgetchar\s*\(`,
			ObjectType:  "",
			MethodName:  "getchar",
			Description: "Single character from stdin",
			Assigns:     "return",
		},
		{
			ID:          "c.stdin.fgetc",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bfgetc\s*\(`,
			ObjectType:  "",
			MethodName:  "fgetc",
			Description: "Single character from file stream",
			Assigns:     "return",
		},
		{
			ID:          "c.stdin.getline",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bgetline\s*\(`,
			ObjectType:  "",
			MethodName:  "getline",
			Description: "POSIX line input with dynamic allocation",
			Assigns:     "arg:0",
		},
		{
			ID:          "c.stdin.read",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `\bread\s*\(\s*(?:STDIN_FILENO|0)\s*,`,
			ObjectType:  "",
			MethodName:  "read",
			Description: "POSIX read from stdin file descriptor",
			Assigns:     "arg:1",
		},

		// --- Command-line arguments ---
		{
			ID:          "c.argv.access",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangC,
			Pattern:     `\bargv\s*\[`,
			ObjectType:  "",
			MethodName:  "argv[]",
			Description: "Command-line argument access",
			Assigns:     "return",
		},
		{
			ID:          "c.argc.access",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangC,
			Pattern:     `\bargc\b`,
			ObjectType:  "",
			MethodName:  "argc",
			Description: "Command-line argument count",
			Assigns:     "return",
		},

		// --- Environment variables ---
		{
			ID:          "c.env.getenv",
			Category:    taint.SrcEnvVar,
			Language:    rules.LangC,
			Pattern:     `\bgetenv\s*\(`,
			ObjectType:  "",
			MethodName:  "getenv",
			Description: "Environment variable value",
			Assigns:     "return",
		},

		// --- Network input ---
		{
			ID:          "c.net.recv",
			Category:    taint.SrcNetwork,
			Language:    rules.LangC,
			Pattern:     `\brecv\s*\(`,
			ObjectType:  "",
			MethodName:  "recv",
			Description: "Data received from network socket",
			Assigns:     "arg:1",
		},
		{
			ID:          "c.net.recvfrom",
			Category:    taint.SrcNetwork,
			Language:    rules.LangC,
			Pattern:     `\brecvfrom\s*\(`,
			ObjectType:  "",
			MethodName:  "recvfrom",
			Description: "Data received from network socket with source address",
			Assigns:     "arg:1",
		},
		{
			ID:          "c.net.recvmsg",
			Category:    taint.SrcNetwork,
			Language:    rules.LangC,
			Pattern:     `\brecvmsg\s*\(`,
			ObjectType:  "",
			MethodName:  "recvmsg",
			Description: "Message received from network socket",
			Assigns:     "arg:1",
		},

		// --- File input ---
		{
			ID:          "c.file.fread",
			Category:    taint.SrcFileRead,
			Language:    rules.LangC,
			Pattern:     `\bfread\s*\(`,
			ObjectType:  "",
			MethodName:  "fread",
			Description: "Binary data read from file",
			Assigns:     "arg:0",
		},
		{
			ID:          "c.file.read",
			Category:    taint.SrcFileRead,
			Language:    rules.LangC,
			Pattern:     `\bread\s*\(\s*(?!(?:STDIN_FILENO|0)\s*,)`,
			ObjectType:  "",
			MethodName:  "read",
			Description: "POSIX read from file descriptor",
			Assigns:     "arg:1",
		},

		// --- CGI environment ---
		{
			ID:          "c.cgi.query_string",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"QUERY_STRING"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(QUERY_STRING)",
			Description: "CGI query string from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.cgi.request_method",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"REQUEST_METHOD"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(REQUEST_METHOD)",
			Description: "CGI request method from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.cgi.content_type",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"CONTENT_TYPE"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(CONTENT_TYPE)",
			Description: "CGI content type from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.cgi.content_length",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"CONTENT_LENGTH"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(CONTENT_LENGTH)",
			Description: "CGI content length from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.cgi.http_cookie",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"HTTP_COOKIE"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(HTTP_COOKIE)",
			Description: "CGI HTTP cookie from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.cgi.path_info",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"PATH_INFO"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(PATH_INFO)",
			Description: "CGI path info from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.cgi.http_host",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"HTTP_HOST"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(HTTP_HOST)",
			Description: "CGI HTTP host from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.cgi.http_referer",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"HTTP_REFERER"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(HTTP_REFERER)",
			Description: "CGI HTTP referer from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.cgi.http_user_agent",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `getenv\s*\(\s*"HTTP_USER_AGENT"\s*\)`,
			ObjectType:  "",
			MethodName:  "getenv(HTTP_USER_AGENT)",
			Description: "CGI HTTP user agent from environment",
			Assigns:     "return",
		},
		{
			ID:          "c.net.mhd_lookup",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `MHD_lookup_connection_value\s*\(`,
			ObjectType:  "",
			MethodName:  "MHD_lookup_connection_value",
			Description: "libmicrohttpd connection value (headers, query params, cookies)",
			Assigns:     "return",
		},
		{
			ID:          "c.net.evhttp_uri",
			Category:    taint.SrcUserInput,
			Language:    rules.LangC,
			Pattern:     `evhttp_request_get_uri\s*\(`,
			ObjectType:  "",
			MethodName:  "evhttp_request_get_uri",
			Description: "libevent HTTP request URI",
			Assigns:     "return",
		},
		{
			ID:          "c.file.mmap",
			Category:    taint.SrcFileRead,
			Language:    rules.LangC,
			Pattern:     `\bmmap\s*\(`,
			ObjectType:  "",
			MethodName:  "mmap",
			Description: "Memory-mapped file contents",
			Assigns:     "return",
		},
	}
}
