package languages

import (
	"github.com/turenio/gtss/internal/rules"
	"github.com/turenio/gtss/internal/taint"
)

func (c *CCatalog) Sinks() []taint.SinkDef {
	return []taint.SinkDef{
		// --- Buffer Overflow / Memory Corruption (CWE-120, CWE-119) ---
		{
			ID:            "c.mem.strcpy",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bstrcpy\s*\(`,
			ObjectType:    "",
			MethodName:    "strcpy",
			DangerousArgs: []int{1},
			Severity:      rules.Critical,
			Description:   "Unbounded string copy with potentially tainted source",
			CWEID:         "CWE-120",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.strcat",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bstrcat\s*\(`,
			ObjectType:    "",
			MethodName:    "strcat",
			DangerousArgs: []int{1},
			Severity:      rules.Critical,
			Description:   "Unbounded string concatenation with potentially tainted source",
			CWEID:         "CWE-120",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.sprintf",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bsprintf\s*\(`,
			ObjectType:    "",
			MethodName:    "sprintf",
			DangerousArgs: []int{1, 2},
			Severity:      rules.Critical,
			Description:   "Unbounded formatted string write with potentially tainted input",
			CWEID:         "CWE-120",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.vsprintf",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bvsprintf\s*\(`,
			ObjectType:    "",
			MethodName:    "vsprintf",
			DangerousArgs: []int{1},
			Severity:      rules.Critical,
			Description:   "Unbounded variadic formatted string write with potentially tainted input",
			CWEID:         "CWE-120",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.memcpy",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bmemcpy\s*\(`,
			ObjectType:    "",
			MethodName:    "memcpy",
			DangerousArgs: []int{1, 2},
			Severity:      rules.High,
			Description:   "Memory copy with potentially tainted source or size",
			CWEID:         "CWE-120",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.memmove",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bmemmove\s*\(`,
			ObjectType:    "",
			MethodName:    "memmove",
			DangerousArgs: []int{1, 2},
			Severity:      rules.High,
			Description:   "Memory move with potentially tainted source or size",
			CWEID:         "CWE-120",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.strncpy",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bstrncpy\s*\(`,
			ObjectType:    "",
			MethodName:    "strncpy",
			DangerousArgs: []int{1, 2},
			Severity:      rules.High,
			Description:   "Bounded string copy with potentially tainted source or incorrect size",
			CWEID:         "CWE-120",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.gets",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bgets\s*\(`,
			ObjectType:    "",
			MethodName:    "gets",
			DangerousArgs: []int{0},
			Severity:      rules.Critical,
			Description:   "Unbounded stdin read (always vulnerable, use fgets instead)",
			CWEID:         "CWE-242",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- Command Injection (CWE-78) ---
		{
			ID:            "c.exec.system",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bsystem\s*\(`,
			ObjectType:    "",
			MethodName:    "system",
			DangerousArgs: []int{0},
			Severity:      rules.Critical,
			Description:   "Shell command execution with potentially tainted input",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.exec.popen",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bpopen\s*\(`,
			ObjectType:    "",
			MethodName:    "popen",
			DangerousArgs: []int{0},
			Severity:      rules.Critical,
			Description:   "Piped command execution with potentially tainted input",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.exec.execl",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bexecl\s*\(`,
			ObjectType:    "",
			MethodName:    "execl",
			DangerousArgs: []int{0, 1, 2},
			Severity:      rules.Critical,
			Description:   "Process execution with potentially tainted arguments",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.exec.execv",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bexecv\s*\(`,
			ObjectType:    "",
			MethodName:    "execv",
			DangerousArgs: []int{0, 1},
			Severity:      rules.Critical,
			Description:   "Process execution with potentially tainted path or arguments",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.exec.execve",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bexecve\s*\(`,
			ObjectType:    "",
			MethodName:    "execve",
			DangerousArgs: []int{0, 1, 2},
			Severity:      rules.Critical,
			Description:   "Process execution with potentially tainted path, arguments, or environment",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.exec.execvp",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bexecvp\s*\(`,
			ObjectType:    "",
			MethodName:    "execvp",
			DangerousArgs: []int{0, 1},
			Severity:      rules.Critical,
			Description:   "Process execution with PATH search and potentially tainted input",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.exec.execlp",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bexeclp\s*\(`,
			ObjectType:    "",
			MethodName:    "execlp",
			DangerousArgs: []int{0, 1, 2},
			Severity:      rules.Critical,
			Description:   "Process execution with PATH search and potentially tainted arguments",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.exec.execle",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bexecle\s*\(`,
			ObjectType:    "",
			MethodName:    "execle",
			DangerousArgs: []int{0, 1, 2},
			Severity:      rules.Critical,
			Description:   "Process execution with environment and potentially tainted arguments",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.exec.execvpe",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bexecvpe\s*\(`,
			ObjectType:    "",
			MethodName:    "execvpe",
			DangerousArgs: []int{0, 1, 2},
			Severity:      rules.Critical,
			Description:   "Process execution with PATH search, environment, and potentially tainted input",
			CWEID:         "CWE-78",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- Format String Vulnerability (CWE-134) ---
		{
			ID:            "c.fmt.printf",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bprintf\s*\(`,
			ObjectType:    "",
			MethodName:    "printf",
			DangerousArgs: []int{0},
			Severity:      rules.Critical,
			Description:   "Format string with potentially tainted format argument",
			CWEID:         "CWE-134",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.fmt.fprintf",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bfprintf\s*\(`,
			ObjectType:    "",
			MethodName:    "fprintf",
			DangerousArgs: []int{1},
			Severity:      rules.Critical,
			Description:   "Format string to file with potentially tainted format argument",
			CWEID:         "CWE-134",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.fmt.snprintf.format",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bsnprintf\s*\(`,
			ObjectType:    "",
			MethodName:    "snprintf",
			DangerousArgs: []int{2},
			Severity:      rules.High,
			Description:   "Bounded format string with potentially tainted format argument",
			CWEID:         "CWE-134",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.fmt.syslog",
			Category:      taint.SnkLog,
			Language:      rules.LangC,
			Pattern:       `\bsyslog\s*\(`,
			ObjectType:    "",
			MethodName:    "syslog",
			DangerousArgs: []int{1},
			Severity:      rules.High,
			Description:   "Syslog with potentially tainted format string or data",
			CWEID:         "CWE-134",
			OWASPCategory: "A09:2021-Security Logging and Monitoring Failures",
		},

		// --- File Operations / Path Traversal (CWE-22) ---
		{
			ID:            "c.file.fopen",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bfopen\s*\(`,
			ObjectType:    "",
			MethodName:    "fopen",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "File open with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.open",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bopen\s*\(`,
			ObjectType:    "",
			MethodName:    "open",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "POSIX file open with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.rename",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\brename\s*\(`,
			ObjectType:    "",
			MethodName:    "rename",
			DangerousArgs: []int{0, 1},
			Severity:      rules.High,
			Description:   "File rename with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.unlink",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bunlink\s*\(`,
			ObjectType:    "",
			MethodName:    "unlink",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "File deletion with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.remove",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bremove\s*\(`,
			ObjectType:    "",
			MethodName:    "remove",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "File removal with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.chmod",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bchmod\s*\(`,
			ObjectType:    "",
			MethodName:    "chmod",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "File permission change with potentially tainted path",
			CWEID:         "CWE-732",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.access",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\baccess\s*\(`,
			ObjectType:    "",
			MethodName:    "access",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "File access check with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.stat",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bstat\s*\(`,
			ObjectType:    "",
			MethodName:    "stat",
			DangerousArgs: []int{0},
			Severity:      rules.Medium,
			Description:   "File stat with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.mkdir",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bmkdir\s*\(`,
			ObjectType:    "",
			MethodName:    "mkdir",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Directory creation with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},

		// --- Memory Allocation with Tainted Size (CWE-789) ---
		{
			ID:            "c.mem.malloc",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bmalloc\s*\(`,
			ObjectType:    "",
			MethodName:    "malloc",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Memory allocation with potentially tainted size",
			CWEID:         "CWE-789",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.calloc",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bcalloc\s*\(`,
			ObjectType:    "",
			MethodName:    "calloc",
			DangerousArgs: []int{0, 1},
			Severity:      rules.High,
			Description:   "Memory allocation with potentially tainted count or size",
			CWEID:         "CWE-789",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.realloc",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\brealloc\s*\(`,
			ObjectType:    "",
			MethodName:    "realloc",
			DangerousArgs: []int{1},
			Severity:      rules.High,
			Description:   "Memory reallocation with potentially tainted size",
			CWEID:         "CWE-789",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.mem.alloca",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\balloca\s*\(`,
			ObjectType:    "",
			MethodName:    "alloca",
			DangerousArgs: []int{0},
			Severity:      rules.Critical,
			Description:   "Stack allocation with potentially tainted size (stack overflow risk)",
			CWEID:         "CWE-789",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- SQL Injection (CWE-89) ---
		{
			ID:            "c.sql.sqlite3_exec",
			Category:      taint.SnkSQLQuery,
			Language:      rules.LangC,
			Pattern:       `\bsqlite3_exec\s*\(`,
			ObjectType:    "",
			MethodName:    "sqlite3_exec",
			DangerousArgs: []int{1},
			Severity:      rules.Critical,
			Description:   "SQLite query execution with potentially tainted SQL string",
			CWEID:         "CWE-89",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.sql.mysql_query",
			Category:      taint.SnkSQLQuery,
			Language:      rules.LangC,
			Pattern:       `\bmysql_query\s*\(`,
			ObjectType:    "",
			MethodName:    "mysql_query",
			DangerousArgs: []int{1},
			Severity:      rules.Critical,
			Description:   "MySQL query execution with potentially tainted SQL string",
			CWEID:         "CWE-89",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.sql.mysql_real_query",
			Category:      taint.SnkSQLQuery,
			Language:      rules.LangC,
			Pattern:       `\bmysql_real_query\s*\(`,
			ObjectType:    "",
			MethodName:    "mysql_real_query",
			DangerousArgs: []int{1},
			Severity:      rules.Critical,
			Description:   "MySQL real query execution with potentially tainted SQL string",
			CWEID:         "CWE-89",
			OWASPCategory: "A03:2021-Injection",
		},
		{
			ID:            "c.sql.pqexec",
			Category:      taint.SnkSQLQuery,
			Language:      rules.LangC,
			Pattern:       `\bPQexec\s*\(`,
			ObjectType:    "",
			MethodName:    "PQexec",
			DangerousArgs: []int{1},
			Severity:      rules.Critical,
			Description:   "PostgreSQL query execution with potentially tainted SQL string",
			CWEID:         "CWE-89",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- Network Output (CWE-319) ---
		{
			ID:            "c.net.send",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bsend\s*\(`,
			ObjectType:    "",
			MethodName:    "send",
			DangerousArgs: []int{1},
			Severity:      rules.Medium,
			Description:   "Network send with potentially tainted data",
			CWEID:         "CWE-319",
			OWASPCategory: "A02:2021-Cryptographic Failures",
		},
		{
			ID:            "c.net.sendto",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bsendto\s*\(`,
			ObjectType:    "",
			MethodName:    "sendto",
			DangerousArgs: []int{1},
			Severity:      rules.Medium,
			Description:   "Network sendto with potentially tainted data",
			CWEID:         "CWE-319",
			OWASPCategory: "A02:2021-Cryptographic Failures",
		},
		{
			ID:            "c.net.write",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bwrite\s*\(`,
			ObjectType:    "",
			MethodName:    "write",
			DangerousArgs: []int{1},
			Severity:      rules.Medium,
			Description:   "POSIX write with potentially tainted data to socket",
			CWEID:         "CWE-319",
			OWASPCategory: "A02:2021-Cryptographic Failures",
		},

		// --- SSRF / URL Fetch (CWE-918) ---
		{
			ID:            "c.ssrf.getaddrinfo",
			Category:      taint.SnkURLFetch,
			Language:      rules.LangC,
			Pattern:       `\bgetaddrinfo\s*\(`,
			ObjectType:    "",
			MethodName:    "getaddrinfo",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "DNS resolution with potentially tainted hostname (SSRF)",
			CWEID:         "CWE-918",
			OWASPCategory: "A10:2021-Server-Side Request Forgery",
		},
		{
			ID:            "c.ssrf.connect",
			Category:      taint.SnkURLFetch,
			Language:      rules.LangC,
			Pattern:       `\bconnect\s*\(`,
			ObjectType:    "",
			MethodName:    "connect",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Socket connect with potentially tainted address (SSRF)",
			CWEID:         "CWE-918",
			OWASPCategory: "A10:2021-Server-Side Request Forgery",
		},
		{
			ID:            "c.ssrf.curl_setopt_url",
			Category:      taint.SnkURLFetch,
			Language:      rules.LangC,
			Pattern:       `curl_easy_setopt\s*\([^,]+,\s*CURLOPT_URL`,
			ObjectType:    "",
			MethodName:    "curl_easy_setopt(CURLOPT_URL)",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "libcurl URL set with potentially tainted URL (SSRF)",
			CWEID:         "CWE-918",
			OWASPCategory: "A10:2021-Server-Side Request Forgery",
		},

		// --- Weak Cryptography (CWE-327, CWE-328, CWE-338) ---
		{
			ID:            "c.crypto.md5",
			Category:      taint.SnkCrypto,
			Language:      rules.LangC,
			Pattern:       `\bMD5\s*\(|MD5_Init\s*\(`,
			ObjectType:    "",
			MethodName:    "MD5",
			DangerousArgs: []int{0},
			Severity:      rules.Medium,
			Description:   "Weak MD5 hash function used for security-sensitive operation",
			CWEID:         "CWE-328",
			OWASPCategory: "A02:2021-Cryptographic Failures",
		},
		{
			ID:            "c.crypto.sha1",
			Category:      taint.SnkCrypto,
			Language:      rules.LangC,
			Pattern:       `\bSHA1\s*\(|SHA1_Init\s*\(`,
			ObjectType:    "",
			MethodName:    "SHA1",
			DangerousArgs: []int{0},
			Severity:      rules.Medium,
			Description:   "Weak SHA1 hash function used for security-sensitive operation",
			CWEID:         "CWE-328",
			OWASPCategory: "A02:2021-Cryptographic Failures",
		},
		{
			ID:            "c.crypto.des",
			Category:      taint.SnkCrypto,
			Language:      rules.LangC,
			Pattern:       `DES_(?:ecb|cbc|cfb|ofb)_encrypt\s*\(`,
			ObjectType:    "",
			MethodName:    "DES_encrypt",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Weak DES encryption algorithm (use AES instead)",
			CWEID:         "CWE-327",
			OWASPCategory: "A02:2021-Cryptographic Failures",
		},
		{
			ID:            "c.crypto.insecure_random",
			Category:      taint.SnkCrypto,
			Language:      rules.LangC,
			Pattern:       `\brand\s*\(\s*\)|\bsrand\s*\(`,
			ObjectType:    "",
			MethodName:    "rand",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Insecure pseudo-random number generator (use RAND_bytes or getrandom)",
			CWEID:         "CWE-338",
			OWASPCategory: "A02:2021-Cryptographic Failures",
		},

		// --- Dynamic Loading / Eval (CWE-829) ---
		{
			ID:            "c.eval.dlopen",
			Category:      taint.SnkEval,
			Language:      rules.LangC,
			Pattern:       `\bdlopen\s*\(`,
			ObjectType:    "",
			MethodName:    "dlopen",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Dynamic library loading with potentially tainted path",
			CWEID:         "CWE-829",
			OWASPCategory: "A08:2021-Software and Data Integrity Failures",
		},
		{
			ID:            "c.eval.dlsym",
			Category:      taint.SnkEval,
			Language:      rules.LangC,
			Pattern:       `\bdlsym\s*\(`,
			ObjectType:    "",
			MethodName:    "dlsym",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Dynamic symbol resolution with potentially tainted name",
			CWEID:         "CWE-829",
			OWASPCategory: "A08:2021-Software and Data Integrity Failures",
		},

		// --- XPath Injection (CWE-643) ---
		{
			ID:            "c.xpath.eval",
			Category:      taint.SnkXPath,
			Language:      rules.LangC,
			Pattern:       `xmlXPathEval(?:Expression)?\s*\(`,
			ObjectType:    "",
			MethodName:    "xmlXPathEval",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "XPath evaluation with potentially tainted expression",
			CWEID:         "CWE-643",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- XXE / XML Parsing (CWE-611) ---
		{
			ID:            "c.xml.parse",
			Category:      taint.SnkXPath,
			Language:      rules.LangC,
			Pattern:       `xmlParseMemory\s*\(|xmlParseFile\s*\(|xmlCtxtReadMemory\s*\(`,
			ObjectType:    "",
			MethodName:    "xmlParseMemory",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "XML parsing with potentially tainted input (XXE risk)",
			CWEID:         "CWE-611",
			OWASPCategory: "A05:2021-Security Misconfiguration",
		},

		// --- Open Redirect (CWE-601) ---
		{
			ID:            "c.redirect.cgi_location",
			Category:      taint.SnkRedirect,
			Language:      rules.LangC,
			Pattern:       `printf\s*\(\s*"Location:\s*`,
			ObjectType:    "",
			MethodName:    "printf(Location:)",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "CGI Location header redirect with potentially tainted URL",
			CWEID:         "CWE-601",
			OWASPCategory: "A01:2021-Broken Access Control",
		},

		// --- HTML Output / XSS (CWE-79) ---
		{
			ID:            "c.xss.cgi_html_output",
			Category:      taint.SnkHTMLOutput,
			Language:      rules.LangC,
			Pattern:       `printf\s*\(\s*"Content-Type:\s*text/html`,
			ObjectType:    "",
			MethodName:    "printf(Content-Type: text/html)",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "CGI HTML output with potentially tainted content (XSS)",
			CWEID:         "CWE-79",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- HTTP Header Injection (CWE-113) ---
		{
			ID:            "c.header.cgi_header",
			Category:      taint.SnkHeader,
			Language:      rules.LangC,
			Pattern:       `printf\s*\(\s*"Set-Cookie:|printf\s*\(\s*"[A-Z][a-z]+-[A-Z]`,
			ObjectType:    "",
			MethodName:    "printf(Set-Cookie:)",
			DangerousArgs: []int{0},
			Severity:      rules.Medium,
			Description:   "CGI HTTP header output with potentially tainted values",
			CWEID:         "CWE-113",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- Deserialization / XML (CWE-611) ---
		{
			ID:            "c.deser.xml_root",
			Category:      taint.SnkDeserialize,
			Language:      rules.LangC,
			Pattern:       `xmlDocGetRootElement\s*\(`,
			ObjectType:    "",
			MethodName:    "xmlDocGetRootElement",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "XML document deserialization with potentially tainted input",
			CWEID:         "CWE-611",
			OWASPCategory: "A08:2021-Software and Data Integrity Failures",
		},

		// --- LDAP Injection (CWE-90) ---
		{
			ID:            "c.ldap.search",
			Category:      taint.SnkLDAP,
			Language:      rules.LangC,
			Pattern:       `ldap_search(?:_ext)?(?:_s)?\s*\(`,
			ObjectType:    "",
			MethodName:    "ldap_search",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "LDAP search with potentially tainted filter (LDAP injection)",
			CWEID:         "CWE-90",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- Symlink attacks (CWE-59) ---
		{
			ID:            "c.file.symlink",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bsymlink\s*\(`,
			ObjectType:    "",
			MethodName:    "symlink",
			DangerousArgs: []int{0, 1},
			Severity:      rules.High,
			Description:   "Symlink creation with potentially tainted paths (symlink attack)",
			CWEID:         "CWE-59",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.link",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\blink\s*\(`,
			ObjectType:    "",
			MethodName:    "link",
			DangerousArgs: []int{0, 1},
			Severity:      rules.High,
			Description:   "Hard link creation with potentially tainted paths",
			CWEID:         "CWE-59",
			OWASPCategory: "A01:2021-Broken Access Control",
		},

		// --- Additional file operations ---
		{
			ID:            "c.file.chown",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\bchown\s*\(|fchown\s*\(`,
			ObjectType:    "",
			MethodName:    "chown",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "File ownership change with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
		{
			ID:            "c.file.truncate",
			Category:      taint.SnkFileWrite,
			Language:      rules.LangC,
			Pattern:       `\btruncate\s*\(|ftruncate\s*\(`,
			ObjectType:    "",
			MethodName:    "truncate",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "File truncation with potentially tainted path",
			CWEID:         "CWE-22",
			OWASPCategory: "A01:2021-Broken Access Control",
		},

		// --- ReDoS (CWE-1333) ---
		{
			ID:            "c.regex.regcomp",
			Category:      taint.SnkEval,
			Language:      rules.LangC,
			Pattern:       `\bregcomp\s*\(`,
			ObjectType:    "",
			MethodName:    "regcomp",
			DangerousArgs: []int{1},
			Severity:      rules.High,
			Description:   "POSIX regex compilation with potentially tainted pattern (ReDoS risk)",
			CWEID:         "CWE-1333",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- Format string (CWE-134) ---
		{
			ID:            "c.fmt.vfprintf",
			Category:      taint.SnkLog,
			Language:      rules.LangC,
			Pattern:       `\bvfprintf\s*\(|vprintf\s*\(`,
			ObjectType:    "",
			MethodName:    "vfprintf/vprintf",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Variadic format print with potentially tainted format string",
			CWEID:         "CWE-134",
			OWASPCategory: "A03:2021-Injection",
		},

		// --- Memory: use-after-free potential ---
		{
			ID:            "c.mem.free.double",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bfree\s*\(`,
			ObjectType:    "",
			MethodName:    "free",
			DangerousArgs: []int{0},
			Severity:      rules.High,
			Description:   "Memory free with potentially tainted or dangling pointer",
			CWEID:         "CWE-416",
			OWASPCategory: "A06:2021-Vulnerable and Outdated Components",
		},

		// --- setuid/setgid (CWE-250) ---
		{
			ID:            "c.priv.setuid",
			Category:      taint.SnkCommand,
			Language:      rules.LangC,
			Pattern:       `\bsetuid\s*\(|setgid\s*\(|seteuid\s*\(`,
			ObjectType:    "",
			MethodName:    "setuid/setgid",
			DangerousArgs: []int{0},
			Severity:      rules.Critical,
			Description:   "Privilege escalation via setuid/setgid with tainted value",
			CWEID:         "CWE-250",
			OWASPCategory: "A01:2021-Broken Access Control",
		},
	}
}
