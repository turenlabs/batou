package languages

import (
	"github.com/turenlabs/batou/internal/rules"
	"github.com/turenlabs/batou/internal/taint"
)

func (c *ZigCatalog) Sources() []taint.SourceDef {
	return []taint.SourceDef{
		// --- HTTP server input ---
		{
			ID:          "zig.http.server.request",
			Category:    taint.SrcUserInput,
			Language:    rules.LangZig,
			Pattern:     `std\.http\.Server`,
			ObjectType:  "std.http.Server",
			MethodName:  "std.http.Server",
			Description: "Zig HTTP server request object",
			Assigns:     "return",
		},
		{
			ID:          "zig.http.server.request_target",
			Category:    taint.SrcUserInput,
			Language:    rules.LangZig,
			Pattern:     `\.request\.target`,
			ObjectType:  "std.http.Server.Request",
			MethodName:  "request.target",
			Description: "HTTP request target (URL path/query)",
			Assigns:     "return",
		},
		{
			ID:          "zig.http.server.request_headers",
			Category:    taint.SrcUserInput,
			Language:    rules.LangZig,
			Pattern:     `\.request\.headers`,
			ObjectType:  "std.http.Server.Request",
			MethodName:  "request.headers",
			Description: "HTTP request headers",
			Assigns:     "return",
		},
		{
			ID:          "zig.http.server.read_body",
			Category:    taint.SrcUserInput,
			Language:    rules.LangZig,
			Pattern:     `\.reader\(\)`,
			ObjectType:  "std.http.Server.Response",
			MethodName:  "reader()",
			Description: "HTTP request body reader",
			Assigns:     "return",
		},

		// --- I/O reader input ---
		{
			ID:          "zig.io.reader.read",
			Category:    taint.SrcFileRead,
			Language:    rules.LangZig,
			Pattern:     `\.read\s*\(`,
			ObjectType:  "std.io.Reader",
			MethodName:  "Reader.read",
			Description: "I/O reader read operation",
			Assigns:     "return",
		},
		{
			ID:          "zig.io.reader.readAllAlloc",
			Category:    taint.SrcFileRead,
			Language:    rules.LangZig,
			Pattern:     `\.readAllAlloc\s*\(`,
			ObjectType:  "std.io.Reader",
			MethodName:  "Reader.readAllAlloc",
			Description: "Read entire stream into allocated buffer",
			Assigns:     "return",
		},
		{
			ID:          "zig.io.reader.readUntilDelimiter",
			Category:    taint.SrcFileRead,
			Language:    rules.LangZig,
			Pattern:     `\.readUntilDelimiter\s*\(`,
			ObjectType:  "std.io.Reader",
			MethodName:  "Reader.readUntilDelimiter",
			Description: "Read from stream until delimiter",
			Assigns:     "return",
		},

		// --- CLI arguments ---
		{
			ID:          "zig.os.argv",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangZig,
			Pattern:     `std\.os\.argv`,
			ObjectType:  "",
			MethodName:  "std.os.argv",
			Description: "Program command-line arguments",
			Assigns:     "return",
		},
		{
			ID:          "zig.process.argsAlloc",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangZig,
			Pattern:     `std\.process\.argsAlloc\s*\(`,
			ObjectType:  "std.process",
			MethodName:  "std.process.argsAlloc",
			Description: "Allocated command-line argument iterator",
			Assigns:     "return",
		},
		{
			ID:          "zig.process.ArgIterator",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangZig,
			Pattern:     `std\.process\.ArgIterator`,
			ObjectType:  "std.process",
			MethodName:  "std.process.ArgIterator",
			Description: "Command-line argument iterator type",
			Assigns:     "return",
		},
		{
			ID:          "zig.process.ArgIterator.next",
			Category:    taint.SrcCLIArg,
			Language:    rules.LangZig,
			Pattern:     `\.next\s*\(`,
			ObjectType:  "std.process.ArgIterator",
			MethodName:  "ArgIterator.next",
			Description: "Next command-line argument from iterator",
			Assigns:     "return",
		},

		// --- Environment variables ---
		{
			ID:          "zig.os.environ",
			Category:    taint.SrcEnvVar,
			Language:    rules.LangZig,
			Pattern:     `std\.os\.environ`,
			ObjectType:  "",
			MethodName:  "std.os.environ",
			Description: "Process environment variables",
			Assigns:     "return",
		},
		{
			ID:          "zig.process.getEnvMap",
			Category:    taint.SrcEnvVar,
			Language:    rules.LangZig,
			Pattern:     `std\.process\.getEnvMap\s*\(`,
			ObjectType:  "std.process",
			MethodName:  "std.process.getEnvMap",
			Description: "Get environment variables as map",
			Assigns:     "return",
		},

		// --- Network input ---
		{
			ID:          "zig.net.stream.read",
			Category:    taint.SrcNetwork,
			Language:    rules.LangZig,
			Pattern:     `\.read\s*\(`,
			ObjectType:  "std.net.Stream",
			MethodName:  "Stream.read",
			Description: "Network stream socket read",
			Assigns:     "return",
		},
		{
			ID:          "zig.net.StreamServer.accept",
			Category:    taint.SrcNetwork,
			Language:    rules.LangZig,
			Pattern:     `\.accept\s*\(`,
			ObjectType:  "std.net.StreamServer",
			MethodName:  "StreamServer.accept",
			Description: "Accept incoming network connection",
			Assigns:     "return",
		},

		// --- Deserialization ---
		{
			ID:          "zig.json.parseFromSlice",
			Category:    taint.SrcDeserialized,
			Language:    rules.LangZig,
			Pattern:     `std\.json\.parseFromSlice\s*\(`,
			ObjectType:  "std.json",
			MethodName:  "std.json.parseFromSlice",
			Description: "JSON deserialization from byte slice",
			Assigns:     "return",
		},
		{
			ID:          "zig.json.parseFromSliceLeaky",
			Category:    taint.SrcDeserialized,
			Language:    rules.LangZig,
			Pattern:     `std\.json\.parseFromSliceLeaky\s*\(`,
			ObjectType:  "std.json",
			MethodName:  "std.json.parseFromSliceLeaky",
			Description: "JSON deserialization (leaky allocator variant)",
			Assigns:     "return",
		},
		{
			ID:          "zig.json.parseFromTokenSource",
			Category:    taint.SrcDeserialized,
			Language:    rules.LangZig,
			Pattern:     `std\.json\.parseFromTokenSource\s*\(`,
			ObjectType:  "std.json",
			MethodName:  "std.json.parseFromTokenSource",
			Description: "JSON deserialization from token source",
			Assigns:     "return",
		},

		// --- File system ---
		{
			ID:          "zig.fs.Dir.openFile",
			Category:    taint.SrcFileRead,
			Language:    rules.LangZig,
			Pattern:     `\.openFile\s*\(`,
			ObjectType:  "std.fs.Dir",
			MethodName:  "Dir.openFile",
			Description: "Open file from directory handle",
			Assigns:     "return",
		},
		{
			ID:          "zig.fs.cwd",
			Category:    taint.SrcFileRead,
			Language:    rules.LangZig,
			Pattern:     `std\.fs\.cwd\s*\(`,
			ObjectType:  "std.fs",
			MethodName:  "std.fs.cwd",
			Description: "Current working directory handle",
			Assigns:     "return",
		},
		{
			ID:          "zig.fs.openFileAbsolute",
			Category:    taint.SrcFileRead,
			Language:    rules.LangZig,
			Pattern:     `std\.fs\.openFileAbsolute\s*\(`,
			ObjectType:  "std.fs",
			MethodName:  "std.fs.openFileAbsolute",
			Description: "Open file by absolute path",
			Assigns:     "return",
		},
	}
}
